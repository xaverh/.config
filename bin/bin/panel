#! /bin/sh

if xdo id -a "bspwm_panel" > /dev/null ; then
	printf "%s\n" "The panel is already running." >&2
	exit 1
fi

trap 'trap - TERM; kill 0' INT TERM QUIT EXIT

[ -e /tmp/panel-fifo ] && rm /tmp/panel-fifo
mkfifo /tmp/panel-fifo

go run ~/bin/notionstatus.go > /tmp/panel-fifo &
bspc subscribe report > /tmp/panel-fifo &

panel_bar < /tmp/panel-fifo | lemonbar -a 32 -u 2 -n "bspwm_panel" -g x24 -f "-sgi-screen-medium-r-normal--14-*-72-72-m-*-*-*" -F "#a7a5a5" -B "#333232" | sh &

panel_bar < /tmp/panel-fifo

wid=$(xdo id -m -a "bspwm_panel")
xdo above -t "$(xdo id -N Bspwm -n root | sort | head -n 1)" "$wid"

wait
