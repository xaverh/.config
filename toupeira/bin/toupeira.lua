#!/usr/bin/lua

local cities = {
	au3 = '🇦🇺 Melbourne',
	au4 = '🇦🇺 Melbourne',
	au1 = '🇦🇺 Sydney',
	au2 = '🇦🇺 Sydney',
	au5 = '🇦🇺 Sydney',
	au6 = '🇦🇺 Sydney',
	au7 = '🇦🇺 Sydney',
	at1 = '🇦🇹 Vienna',
	at2 = '🇦🇹 Vienna',
	be1 = '🇧🇪 Brussels',
	be2 = '🇧🇪 Brussels',
	be3 = '🇧🇪 Brussels',
	be4 = '🇧🇪 Brussels',
	br1 = '🇧🇷 São Paulo',
	bg1 = '🇧🇬 Sofia',
	bg2 = '🇧🇬 Sofia',
	bg3 = '🇧🇬 Sofia',
	ca1 = '🇨🇦 Montréal',
	ca3 = '🇨🇦 Montréal',
	ca4 = '🇨🇦 Montréal',
	ca5 = '🇨🇦 Montréal',
	ca6 = '🇨🇦 Montréal',
	ca8 = '🇨🇦 Montréal',
	ca9 = '🇨🇦 Montréal',
	ca2 = '🇨🇦 Vancouver',
	ca7 = '🇨🇦 Vancouver',
	cz4 = '🇨🇿 Prague',
	cz5 = '🇨🇿 Prague',
	dk1 = '🇩🇰 Copenhagen',
	dk2 = '🇩🇰 Copenhagen',
	fi1 = '🇫🇮 Helsinki',
	fi2 = '🇫🇮 Helsinki',
	fi3 = '🇫🇮 Helsinki',
	fr1 = '🇫🇷 Paris',
	fr2 = '🇫🇷 Paris',
	fr3 = '🇫🇷 Paris',
	fr4 = '🇫🇷 Paris',
	fr5 = '🇫🇷 Paris',
	fr6 = '🇫🇷 Paris',
	fr7 = '🇫🇷 Paris',
	fr8 = '🇫🇷 Paris',
	de1 = '🇩🇪 Frankfurt',
	de2 = '🇩🇪 Frankfurt',
	de4 = '🇩🇪 Frankfurt',
	de5 = '🇩🇪 Frankfurt',
	de6 = '🇩🇪 Frankfurt',
	hk1 = '🇭🇰 Hong Kong',
	hu1 = '🇭🇺 Budapest',
	hu2 = '🇭🇺 Budapest',
	ie1 = '🇮🇪 Dublin',
	ie2 = '🇮🇪 Dublin',
	it1 = '🇮🇹 Milan',
	it2 = '🇮🇹 Milan',
	it3 = '🇮🇹 Milan',
	jp1 = '🇯🇵 Tokyo',
	jp2 = '🇯🇵 Tokyo',
	jp3 = '🇯🇵 Tokyo',
	jp4 = '🇯🇵 Tokyo',
	jp5 = '🇯🇵 Tokyo',
	lv1 = '🇱🇻 Riga',
	lu1 = '🇱🇺 Luxembourg',
	lu2 = '🇱🇺 Luxembourg',
	md1 = '🇲🇩 Chișinău',
	nl1 = '🇳🇱 Amsterdam',
	nl2 = '🇳🇱 Amsterdam',
	nl3 = '🇳🇱 Amsterdam',
	nl4 = '🇳🇱 Amsterdam',
	nl5 = '🇳🇱 Amsterdam',
	nz1 = '🇳🇿 Auckland',
	nz2 = '🇳🇿 Auckland',
	no1 = '🇳🇴 Oslo',
	no2 = '🇳🇴 Oslo',
	no3 = '🇳🇴 Oslo',
	no4 = '🇳🇴 Oslo',
	pl1 = '🇵🇱 Warsaw',
	pl2 = '🇵🇱 Warsaw',
	pl3 = '🇵🇱 Warsaw',
	pl4 = '🇵🇱 Warsaw',
	ro1 = '🇷🇴 Bucharest',
	ro2 = '🇷🇴 Bucharest',
	ro3 = '🇷🇴 Bucharest',
	rs1 = '🇷🇸 Belgrade',
	rs2 = '🇷🇸 Belgrade',
	sg1 = '🇸🇬 Singapore',
	sg2 = '🇸🇬 Singapore',
	sg3 = '🇸🇬 Singapore',
	es1 = '🇪🇸 Madrid',
	es2 = '🇪🇸 Madrid',
	es3 = '🇪🇸 Madrid',
	es4 = '🇪🇸 Madrid',
	es5 = '🇪🇸 Madrid',
	se10 = '🇸🇪 Gothenburg',
	se3 = '🇸🇪 Gothenburg',
	se5 = '🇸🇪 Gothenburg',
	se9 = '🇸🇪 Gothenburg',
	se1 = '🇸🇪 Malmö',
	se4 = '🇸🇪 Malmö',
	se12 = '🇸🇪 Stockholm',
	se13 = '🇸🇪 Stockholm',
	se14 = '🇸🇪 Stockholm',
	se2 = '🇸🇪 Stockholm',
	se6 = '🇸🇪 Stockholm',
	se7 = '🇸🇪 Stockholm',
	se8 = '🇸🇪 Stockholm',
	ch1 = '🇨🇭 Zurich',
	ch2 = '🇨🇭 Zurich',
	ch3 = '🇨🇭 Zurich',
	ch4 = '🇨🇭 Zurich',
	ch5 = '🇨🇭 Zurich',
	ch6 = '🇨🇭 Zurich',
	ch7 = '🇨🇭 Zurich',
	ch8 = '🇨🇭 Zurich',
	ch9 = '🇨🇭 Zurich',
	gb1 = '🇬🇧 London',
	gb2 = '🇬🇧 London',
	gb4 = '🇬🇧 London',
	gb5 = '🇬🇧 London',
	gb6 = '🇬🇧 London',
	gb10 = '🇬🇧 Manchester',
	gb3 = '🇬🇧 Manchester',
	gb7 = '🇬🇧 Manchester',
	gb8 = '🇬🇧 Manchester',
	gb9 = '🇬🇧 Manchester',
	us21 = '🇺🇸 Atlanta',
	us38 = '🇺🇸 Atlanta',
	us39 = '🇺🇸 Atlanta',
	us6 = '🇺🇸 Atlanta',
	us18 = '🇺🇸 Chicago',
	us22 = '🇺🇸 Chicago',
	us23 = '🇺🇸 Chicago',
	us4 = '🇺🇸 Chicago',
	us17 = '🇺🇸 Dallas',
	us7 = '🇺🇸 Dallas',
	us10 = '🇺🇸 Los Angeles',
	us11 = '🇺🇸 Los Angeles',
	us2 = '🇺🇸 Los Angeles',
	us35 = '🇺🇸 Los Angeles',
	us36 = '🇺🇸 Los Angeles',
	us37 = '🇺🇸 Los Angeles',
	us8 = '🇺🇸 Los Angeles',
	us19 = '🇺🇸 Miami',
	us20 = '🇺🇸 Miami',
	us27 = '🇺🇸 Miami',
	us3 = '🇺🇸 Miami',
	us40 = '🇺🇸 Miami',
	us41 = '🇺🇸 Miami',
	us42 = '🇺🇸 Miami',
	us43 = '🇺🇸 Miami',
	us1 = '🇺🇸 New York',
	us29 = '🇺🇸 New York',
	us30 = '🇺🇸 New York',
	us31 = '🇺🇸 New York',
	us32 = '🇺🇸 New York',
	us33 = '🇺🇸 New York',
	us34 = '🇺🇸 New York',
	us15 = '🇺🇸 Phoenix',
	us14 = '🇺🇸 Piscataway',
	us24 = '🇺🇸 Salt Lake City',
	us25 = '🇺🇸 Salt Lake City',
	us26 = '🇺🇸 Salt Lake City',
	us9 = '🇺🇸 Salt Lake City',
	us5 = '🇺🇸 Seattle'
}

local servers = {}
local city_list = '❌ Cancel\n🔓 Stop VPN'

for k, v in pairs(cities) do
	servers[v] = k
end

for k, _ in pairs(servers) do
	city_list = city_list .. '\n' .. k
end

function close_old_instance()
	local is_running = os.execute('systemctl is-active wg-quick@*.service')
	if is_running then
		os.execute('systemctl stop wg-quick@*.service')
	end
end

local city_file = io.popen('echo "' .. city_list .. '" | rofi -dmenu -i -no-custom -p "Connect to …"')
local city = string.sub(city_file:read('a'), 1, -2)

if city == '🔓 Stop VPN' then
	close_old_instance()
elseif servers[city] then
	close_old_instance()
	os.execute('systemctl start wg-quick@mullvad-' .. servers[city] .. '.service')
end
